{% extends 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% macro bytesToSize(bytes) %}
{% spaceless %}
    {% set kilobyte = 1024 %}
    {% set megabyte = kilobyte * 1024 %}
    {% set gigabyte = megabyte * 1024 %}
    {% set terabyte = gigabyte * 1024 %}

    {% if bytes|abs < kilobyte %}
        {{ bytes|number_format(2, '.') ~ ' B' }}
    {% elseif bytes|abs < megabyte %}
        {{ (bytes / kilobyte)|number_format(2, '.') ~ ' KB' }}
    {% elseif bytes|abs < gigabyte %}
        {{ (bytes / megabyte)|number_format(2, '.') ~ ' MB' }}
    {% elseif bytes|abs < terabyte %}
        {{ (bytes / gigabyte)|number_format(2, '.') ~ ' GB' }}
    {% else %}
        {{ (bytes / terabyte)|number_format(2, '.') ~ ' TB' }}
    {% endif %}
{% endspaceless %}
{% endmacro %}

{% block toolbar %}
    {% set icon %}
        <img width="18" height="28" alt="Sonatra Forms" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAcCAYAAABsxO8nAAABG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS4xLjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+MahxaQAAAAlwSFlzAAALEwAACxMBAJqcGAAAACBjSFJNAAB6JQAAgIMAAPn/AACA6AAAUggAARVYAAA6lwAAF2/XWh+QAAABWklEQVR42uzVu0pdURDG8Z96vHFQRAVBMRds1cZCLIwpJIIPIJbWacQqpA8EgiZ2PoBY+AJiI9paWfgAEZOIxLuEgCncKRwPSzhb8WCjONWsmdn/Pd+eWeyqLMs8hFV7IHvCoDwbwQUGMIG/6MY0TtCMOXy/q6PXqIuHO9GItoi3oBU9eBX1PdegD/iMmgoVrBXwFTMROMIsfuIS+yjiH06xhz/h/4hzyY6QYQUv8Ck6q09qGhL/Ol4V8mEHBrGILmwHdOmeMnfSw3pAsgpgN0CDoT2FLYeEO0Hp+DcxjMMkdoz2SpexDwdYQH/4Y/eRlloXegOSYa1SUDVe4lvsTYahMnWF2PRfeaBJfAm/BR/xPsmPYzcZykkeaArzOblanCeQM7wp3KI7b4eKaAr/EO+wlQd5G1veVCbXEZ0cxIRLH6ucbWA1LuZpmY5+YzRednXxnv8ijxD0fwCTm1JGvzSqHgAAAABJRU5ErkJggg==" />
        <span class="sf-toolbar-status{% if 50 < collector.total %} sf-toolbar-status-yellow{% endif %}">{{ collector.total }}</span>
    {% endset %}

    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>Total forms</b>
            <span>{{ collector.total }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Masters</b>
            <span>{{ collector.masterSize }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Children</b>
            <span>{{ collector.childrenSize }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Renderer time</b>
            <span>{{ collector.duration|number_format(0, '.') }} ms</span>
        </div>
    {% endset %}
    {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': profiler_url } %}
{% endblock %}

{% block head %}
    {{ parent() }}
    <style>
        {% include '@SonatraFormExtensions/Profiler/profiler.css.twig' %}
    </style>
{% endblock %}

{% block menu %}
<span class="label">
    <span class="icon"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAeCAYAAAAo5+5WAAABG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS4xLjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+MahxaQAAAAlwSFlzAAALEwAACxMBAJqcGAAAACBjSFJNAAB6JQAAgIMAAPn/AACA6AAAUggAARVYAAA6lwAAF2/XWh+QAAABjUlEQVR42uzWMWsVURAF4C95qGjEBEPUQoixkBQmBhFsIhELsbARUltY5ReksbDzJ2hnEyy1kBRKVIJiKQgpgpDCwkYQRIuAgWRtzspmee+5ZEkh5MCwO3dmz9w799zLDhRFYT8waJ9wQNwIR/EFq/HvYQu346/F4E5id5vM+DTGMRN/GodwJf7FGFxK7HKd+AhuJNgWx7A+iGG8xBu8wokk7PT4sNt4UXkexiR8yECBn1kWdLCEh/HnUryMP4pJC97iGkbKQp/y8h1XcR3vMbbHVvwlHsMKpnATmwms42wb4hKzkUxRsQ2cb0s8jHc14gJfcaENcSmV113Il9oSi1xeVEiXMYT7FSnuibgkf4pnOdpPkvygLXF5KjspUFQkOdSEuNMnoSTbwhlMZA82o/NeOI7FfpVPRhElptKSz7W8c3geaf7Ar0ymJ0b/1atcXhs1BW1jodUmZBVV0t+Yb7q7I31yZmoX2FwToQ9kmY9xKgXqdqt2gTXGJD52OYlV+5aW7J7VwQ/L/0v8ZwDRoHXw8YzCoAAAAABJRU5ErkJggg==" alt="" /></span>
    <strong>Forms</strong>
    <span class="count">
        <span>{{ collector.total }}</span>
        <span>{{ collector.duration|number_format(0, '.') }} ms</span>
    </span>
</span>
{% endblock %}

{% block panel %}
    <h2>Forms</h2>
    {% set forms = collector.forms %}

    <table>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th class="right">Memory used</th>
            <th class="right">Memory peak</th>
            <th class="right">Duration</th>
        </tr>
        {% for form in forms %}
            <tr>
                <td><{% if form.is_master %}strong{% else %}span{% endif %} style="margin-left:{{ 14*form.indentation }}px;"><abbr title="{{ form.id }}">{{ form.name }}</abbr>{% if form.is_master %}</strong>{% else %}</span>{% endif %}</td>
                <td><abbr title="{{ form.type_class }}">{{ form.type }}</abbr></td>
                <td class="right">{{ bytesToSize(form.memory_used) }}</td>
                <td class="right">{{ bytesToSize(form.memory_peak) }}</td>
                <td class="right">{{ form.duration|number_format(0, '.') }} ms</td>
            </tr>
        {% endfor %}

        {% if forms|length == 0 %}
            <tr>
                <td colspan="5">{{ 'no_form_rendered'|trans({}, 'profiler') }}</td>
            </tr>
        {% endif %}
    </table>
{% endblock %}
